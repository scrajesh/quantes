var c=console.debug;if(!Array.prototype.forEach){Array.prototype.forEach=function(f){for(var i=0,len=this.length;i<len;++i){f.call(this,this[i],i)}}}Array.prototype.is_array=function(){return this.constructor.name==="Array"};Array.prototype.walk=Array.prototype.forEach;if(!Object.prototype.forEach){Object.prototype.forEach=function(f){for(var i in this){f.call(this,this[i],i)}}}Object.prototype.walk=function(f){for(var i in this){if(this.hasOwnProperty(i)){f.call(this,this[i],i)}}};HTMLCollection.prototype.walk=function(f){for(var i=0;i<this.length;i++){f.call(this,this[i],i)}};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!String.prototype.supplant){String.prototype.supplant=function(o){return this.replace(/\{([^{}]*)\}/g,function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a})}}Array.prototype.is_str=function(){return this.constructor.name==="String"};function is_function(value){return typeof value==="function"}function functions(abject){var result=[];abject.walk(function(v,k){if(is_function(v)){result.push(k)}});return result.sort()}function O(selector){var obj;if(selector.match(/^#/)){obj=document.getElementById(selector.substr(1))}else{if(selector.match(/\./)&&document.getElementsByClassName){var tmp=document.getElementsByClassName(selector.substr(1));if(tmp.length>1){obj=[];for(var i=0;i<tmp.length;i++){obj[i]=tmp[i]}}else{obj=tmp.length?tmp[i]:null}}}return obj}function DO_M(){this.el=null;var self=this;return function(selector){if(typeof selector==="object"){self.el=selector}else{if(/^\w+$/.test(selector)){self.el=selector}else{self.el=O(selector);if(self.el.length>0){self.el=self.el[0]}}}return self}}var d=new DO_M();function _d_mixin(dobjs){functions(dobjs).forEach(function(f){DO_M.prototype[f]=dobjs[f]})}_d_mixin({prev:function(elem){elem=(!elem?this.el:elem);do{elem=elem.previousSibling}while(elem&&elem.nodeType!=1);return elem},next:function(elem){elem=(!elem?this.el:elem);do{elem=elem.nextSibling}while(elem&&elem.nodeType!=1);return elem},first:function(elem){elem=(!elem?this.el:elem);var elemnt=elem.firstChild;return elemnt&&elemnt.nodeType!=1?this.next(elemnt):elemnt},last:function(elem){elem=(!elem?this.el:elem);var elemnt=elem.lastChild;return elemnt&&elemnt.nodeType!=1?this.prev(elemnt):elemnt},parent:function(elem){elem=(!elem?this.el:elem);return elem.parentNode},bytag:function(name,parent){parent=(!parent?this.el:parent);var obj,tmp=(parent||document).getElementsByTagName(name);if(tmp.length>1){obj=[];for(var i=0;i<tmp.length;i++){obj[i]=tmp[i]}}else{obj=tmp.length?tmp[i]:null}return obj},nodes:function(name,sel,parent){parent=this.de_fact(parent);var coll=[];if(!sel){var m;if(m=name.match(/#|\./)){var tmp=name.split(m[0]);sel=tmp[1]}}if(sel&&parent){var elem=this.first(parent),i=1,pattn=new RegExp(sel);do{if(pattn.test(elem.className)||pattn.test(elem.id)){coll.push(elem)}elem=this.next(elem)}while(elem);return coll}return this.bytag(name,parent)},html:function(htmlstr){if(typeof htmlstr==="string"){var _div=document.createElement("div"),_c=[];_div.innerHTML=htmlstr;if(_div.children.length>1){var _tmp=this.first(_div);while(_tmp){_c.push(_tmp);_tmp=this.next(_div)}}return(_c.length?_c:_div.children[0])}return htmlstr.innerHTML},wrapit:function(htmlstr,nest){var _wrapped=document.createElement(nest||"div");_wrapped.innerHTML=htmlstr;return _wrapped},appendto:function(nodes,parent){parent=(!parent?this.el:parent);if(nodes.length){nodes.walk(function(n){parent.appendChild(n)})}else{parent.appendChild(nodes)}},fitto:function(nodes,parent){parent=(!parent?this.el:parent);parent.innerHTML="";if(nodes.length){nodes.walk(function(n){parent.appendChild(n)})}else{parent.appendChild(nodes)}},rmvnode:function(node,parent){parent=(!parent?this.el:parent);parent.removeChild(node)},rmvlast:function(parent,klass){parent=(!parent?this.el:parent);var _last_el=this.last(parent);if(!klass||(klass&&this.has_class(klass,_last_el))){this.rmvnode(_last_el,parent)}},attr:function(attrib,value,elem){elem=(!elem?this.el:elem);if(typeof value==="string"){elem.setAttribute(attrib,value)}return elem.getAttribute(attrib,value)},text:function(txt,parent){var t=document.createTextNode(txt);parent.appendChild(t)},getbuttons:function(coll){var _tmp=[];for(var i=0;i<coll.length;i++){if(/submit|button/.test(coll[i].type)){_tmp.push(coll[i])}}return _tmp},can_placeholder:function(coll){var input=document.createElement("input");return("placeholder" in input)},de_fact:function(el){if(el){return(this.is_array(el)?el[0]:el)}else{return this.el}}});_d_mixin({echo:function(){c("Hello.. am: ",this.el)},plugin:function(f){this[this.el]=f},is_error_tagd:function(itarget){var e_tag=this.next(itarget);return(e_tag&&e_tag.tagName.toLowerCase()=="span"&&e_tag.getAttribute("error"))},throw_error:function(itarget,msg){if(this.is_error_tagd(itarget)){this.next(itarget).innerHTML=msg;return}var span=document.createElement("span");span.className="error";span.innerHTML=msg;span.setAttribute("error","true");itarget.parentNode.appendChild(span)},rmv_error:function(itarget){if(this.is_error_tagd(itarget)){this.parent(itarget).removeChild(this.next(itarget))}},dont_act:function(e){if(e&&e.preventDefault){e.preventDefault()}else{window.event.returnValue=false}return false},is_array:function(obj){return obj.constructor.name==="Array"},is_str:function(obj){return obj.constructor.name==="String"}});_d_mixin({slide:function(opts){var slider=opts.slider,slideinitpos=0,parentw=parseInt(this.get_style(opts.parent,"width"));var _raw=this.ex(opts.parent);console.debug(this.ex(opts.parent),this.ey(opts.parent));function rotate(){var ces=slider.style;var cleft=parseInt(ces.left);if(opts.side=="left"){ces.left=(cleft+opts.frames)+"px"}else{ces.right=(cleft-opts.frames)+"px"}if(cleft>=slideinitpos){setTimeout(rotate,3)}else{go()}}function go(){slider.style.left=opts.side=="left"?"-"+parentw+"px":parentw+"px";slider.style.zIndex=5;slider.style.display="block";setTimeout(rotate,50)}go()}});_d_mixin({ajax:function(opts){var self=this,xhr;if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else{if(window.ActiveXObject){xhr=new ActiveXObject("Microsoft.XMLHTTP")}}xhr.open((opts.http?opts.http:"GET"),opts.url,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.setRequestHeader("Accept","application/json");xhr.onreadystatechange=function(){if(xhr.readyState<4){return}if(xhr.status!==200){if("fail" in opts){opts.fail.call(("bind" in opts?opts.bind:self))}return}if(xhr.readyState===4){opts.success.call(("bind" in opts?opts.bind:self),jsonParse(xhr.responseText))}};xhr.send((opts.q?opts.q:null))},load_json:function(url,callback){this.ajax({url:url,success:callback})},postit:function(opts){if("data" in opts){opts.q="";opts.data.walk(function(v,k){opts.q+=k+"="+escape(v)+"&"})}this.ajax(opts)}});d("go").plugin(function(f){f.call(this)});_d_mixin({get_style:function(elem,name){elem=(!elem?this.el:elem);if(elem.style[name]){return elem.style[name]}else{if(elem.currentStyle){return elem.currentStyle[name]}else{if(document.defaultView&&document.defaultView.getComputedStyle){name=name.replace(/([A-Z])/g,"-$1");name=name.toLowerCase();var s=document.defaultView.getComputedStyle(elem,"");return s&&s.getPropertyValue(name)}else{return null}}}},get_rawcss:function(elem){elem=(!elem?this.el:elem);if(document.defaultView&&document.defaultView.getComputedStyle){return document.defaultView.getComputedStyle(elem,"")}return null},get_height:function(elem){elem=(!elem?this.el:elem);return parseInt(this.get_style(elem,"height"))},get_width:function(elem){elem=(!elem?this.el:elem);return parseInt(this.get_style(elem,"width"))},height:function(elem){elem=(!elem?this.el:elem);if(this.get_style(elem,"display")!="none"){return elem.offsetHeight||this.get_height(elem)}var old=this.reset_css(elem,{display:"",visibility:"hidden",position:"absolute"});var h=elem.clientHeight||this.get_height(elem);this.restore_css(elem,old);return h},width:function(elem){elem=(!elem?this.el:elem);if(this.get_style(elem,"display")!="none"){return elem.offsetWidth||this.get_width(elem)}var old=this.reset_css(elem,{display:"",visibility:"hidden",position:"absolute"});var w=elem.clientWidth||this.get_width(elem);this.restore_css(elem,old);return w},reset_css:function(elem,prop){var old={};for(var i in prop){old[i]=elem.style[i];elem.style[i]=prop[i]}return old},restore_css:function(elem,prop){for(var i in prop){elem.style[i]=prop[i]}},hide:function(elem){elem=this.is_str(elem)?O(elem):elem;var curDisplay=this.get_style(elem,"display");if(curDisplay!="none"){elem.$oldDisplay=curDisplay}elem.style.display="none"},show:function(elem){elem=this.is_str(elem)?O(elem):elem;elem.style.display=elem.$oldDisplay||"block"},opacity:function(elem,level){if(elem.filters){elem.style.filters="alpha(opacity="+level+")"}else{elem.style.opacity=level/100}},has_class:function(klass,elem){elem=(!elem?this.el:elem);var regexp=new RegExp("(^| )"+klass+"( |$)");return regexp.test(elem.className)},add_class:function(klass,elem){elem=(!elem?this.el:elem);if(!this.has_class(klass,elem)){var tmp=elem.className;elem.className+=tmp?" "+klass:klass}},rmv_class:function(klass,elem){elem=(!elem?this.el:elem);var rmv_c=elem.className;var re=new RegExp("(^| )"+klass+"( |$)");rmv_c=rmv_c.replace(re,"$1");rmv_c=rmv_c.replace(/ $/,"");elem.className=rmv_c},replace_class:function(rmvklass,repklass,elem){this.rmv_class(rmvklass,elem);this.add_class(repklass,elem)}});_d_mixin({ex:function(elem){elem=(!elem?this.el:elem);return elem.offsetParent?elem.offsetLeft+this.ex(elem.offsetParent):elem.offsetLeft},ey:function(elem){elem=(!elem?this.el:elem);return elem.offsetParent?elem.offsetTop+this.ey(elem.offsetParent):elem.offsetTop},px:function(elem){elem=(!elem?this.el:elem);return elem.parentNode==elem.offsetParent?elem.offsetLeft:this.ex(elem)-this.ex(elem.parentNode)},py:function(elem){elem=(!elem?this.el:elem);return elem.parentNode==elem.offsetParent?elem.offsetTop:this.ey(elem)-this.ey(elem.parentNode)},x:function(elem,pos){elem=(!elem?this.el:elem);if(pos===undefined){return parseInt(this.get_style(elem,"left"))}else{elem.style.left=pos+"px"}},y:function(elem,pos){elem=(!elem?this.el:elem);if(pos===undefined){return parseInt(this.get_style(elem,"top"))}else{elem.style.top=pos+"px"}},xy:function(elem,pos){elem=(!elem?this.el:elem);if(pos===undefined){return{x:parseInt(this.get_style(elem,"left")),y:parseInt(this.get_style(elem,"top"))}}else{var x,y;if(pos.is_array()&&pos.length==2){x=pos[0];y=pos[1]}else{if("left" in pos&&"top" in pos){x=pos.left;y=pos.top}}if(x&&y){this.x(elem,x);this.y(elem,y)}}}});function addEvent(element,type,handler){if(element.addEventListener){element.addEventListener(type,handler,false)}else{if(!handler.$$guid){handler.$$guid=addEvent.guid++}if(!element.events){element.events={}}var handlers=element.events[type];if(!handlers){handlers=element.events[type]={};if(element["on"+type]){handlers[0]=element["on"+type]}}handlers[handler.$$guid]=handler;element["on"+type]=handleEvent}}addEvent.guid=1;function removeEvent(element,type,handler){if(element.removeEventListener){element.removeEventListener(type,handler,false)}else{if(element.events&&element.events[type]){delete element.events[type][handler.$$guid]}}}function handleEvent(event){var returnValue=true;event=event||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var handlers=this.events[event.type];for(var i in handlers){this.$$handleEvent=handlers[i];if(this.$$handleEvent(event)===false){returnValue=false}}return returnValue}function fixEvent(event){event.preventDefault=fixEvent.preventDefault;event.stopPropagation=fixEvent.stopPropagation;return event}fixEvent.preventDefault=function(){this.returnValue=false};fixEvent.stopPropagation=function(){this.cancelBubble=true};_d_mixin({on:function(et,handle,el){var _els=el;if(!el){_els=[this.el]}else{if(this.is_str(el)){_els=[O(el)]}else{if(!this.is_array(el)){_els=[el]}}}for(var i=0;i<_els.length;i++){(function(i){addEvent(_els[i],et,handle)})(i)}},off:function(et,handle,el){var _els=el;if(!el){_els=[this.el]}else{if(this.is_str(el)){_els=[O(el)]}else{if(!this.is_array(el)){_els=[el]}}}for(var i=0;i<_els.length;i++){(function(i){removeEvent(_els[i],et,handle)})(i)}}});if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}};
